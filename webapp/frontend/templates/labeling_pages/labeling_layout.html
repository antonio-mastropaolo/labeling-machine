{% extends "common_pages/common_layout.html" %}

{% block headerStuff %}
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <link href="{{ url_for('static', filename='css/code.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/artifact_common.css') }}" rel="stylesheet" type="text/css">
    <link rel="stylesheet"
          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/default.min.css">

    {#    High priority css classes#}
    <style>
        .buttonWrapper{
            padding-bottom:7px;
            border-radius: 25px;
            padding-right: 5px;
            padding-left: 3px;
        }

        .animationLabel{
            animation:color-me-in 5s;
        }

       @keyframes color-me-in {
          /* You could think of as "step 1" */
          0% {
            background: red;
          }
          /* You could think of as "step 2" */
          100% {
            background: black;
          }
       }

    </style>

{% endblock %}

<!-- Bootstrap container -->
 <div class="container">

        {% block content %}

            <div class="row no-gutters" style="background-color: black; padding-top: 10px;">

                     <div class="col-lg-4">
                        <div class="text-left">
                            <button class="btn btn-outline-info"
                                    type="submit"
                                    id="interestingBtn"#}
                                    onclick="ToggleInterestingBtn({{ artifact_id }})"
                                    style="width: 100%;"> Interesting (?)
                            </button>
                        </div>

                     </div>

                <div class="col-lg-4">
                    <div style="text-align: center; font-size: medium; color: white;">
                        {{ overall_labeling_status['n_artifacts_labeled'] }}
                        out of
                        {{ overall_labeling_status['n_artifacts_to_be_labeled'] }} | <em>{{ overall_labeling_status['source_name'] }}</em>
                    </div>
                    <div class="justify-content-center" style="display: flex;">
                        <div class="progress" style="width:50%;">
                            <div id="top-progress-bar-status" class="progress-bar" role="progressbar" style="width: 0%; "
                                 aria-valuenow="0"
                                 aria-valuemin="0"
                                 aria-valuemax="100">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="text-right">
                        <button class="btn btn-outline-success"
                                type="submit"
                                id="next-skip-btn"
                                onclick="skip_next_artifact()"
                                style="width: 100%;"> Skip
                        </button>
                    </div>

                </div>

            </div>

            <div class="row no-gutters" style="background-color: black; height: 15px;">

                <div class="col-lg-12">
                    <div class="" style="position: relative; padding-left: 20px;"></div>
                </div>

            </div>


            <div class="row no-gutters">

                  <div class="col-lg-2 vh-100" style="background-color: black;">

                      <div class="buttonWrapper">
                          <button class="btn btn btn-dark"
                            type="submit"
                            id="next-skip-btn"
                            onclick=""
                            style="width: 100%" > Code Summary
                          </button>
                      </div>

                      <div class="buttonWrapper">
                          <button class="btn btn btn-dark"
                            type="submit"
                            id="next-skip-btn"
                            onclick=""
                            style="width: 100%" > Code Summary
                          </button>
                      </div>

                      <div class="buttonWrapper">
                          <button class="btn btn btn-dark"
                            type="submit"
                            id="next-skip-btn"
                            onclick=""
                            style="width: 100%" > Code Summary
                          </button>
                      </div>

                      <div class="buttonWrapper">
                          <button class="btn btn btn-dark"
                            type="submit"
                            id="next-skip-btn"
                            onclick=""
                            style="width: 100%" > Code Summary
                          </button>
                      </div>

                      <div class="buttonWrapper">
                          <button class="btn btn btn-dark"
                            type="submit"
                            id="next-skip-btn"
                            onclick=""
                            style="width: 100%" > Code Summary
                          </button>
                      </div>

                      <div class="buttonWrapper">
                          <button class="btn btn btn-dark"
                            type="submit"
                            id="next-skip-btn"
                            onclick=""
                            style="width: 100%" > Code Summary
                          </button>
                      </div>

                  </div>

                <div class="col-lg-8 overflow-auto" id="codeColumn" style="overflow-y: scroll; height: 90vh";>

                    {% highlight 'java', lineno='inline' %}
                        {{ artifact_class }}
                    {% endhighlight %}

                </div>

                <div class="col-lg-2 no-float" id="methodsLabel" style="background-color: black;">


{#                   <!-- This Div is dyamically filled -->#}

                </div>

            </div>

        {% endblock %}
 </div>


{% block scriptsStuff %}

    <script>

        // -------------------------Start-------------------------

        //Newly defined functions

        function highlightRow(selector){

             $(selector).prop('style').removeProperty('animation');
        }

        function moveToSelectedMethod(startingLine, endingLine) {
            console.log(startingLine + ' ------ ' + endingLine);
            var selector = 'span:contains(' + startingLine + ')';
            $(selector)[0].scrollIntoViewIfNeeded();

            $(selector).addClass('animationLabel').delay(1500).queue(function(){
                $(this).removeClass('animationLabel').dequeue();
            });


        }


        // -------------------------End-------------------------

        $(document).ready(function () {


            // Dynamically adding button on the right panel
            const methodList = JSON.parse('{{ artifact_methodList | tojson }}');

            for (let i = 0; i < methodList.length; i++) {
              var buttonID = "method-button-"+i;
              var startingLine = methodList[i].split("-")[0];
              var endingLine = methodList[i].split("-")[1];
              var buttonText = "Method_"+i+" " +startingLine + '---' + endingLine;
              var scorllCall = 'moveToSelectedMethod(' + startingLine +',' + endingLine +')';
              var newButton = '<div class="buttonWrapper"> <button class="btn btn btn-dark" type="submit" id="' + buttonID + '" onclick="' + scorllCall + '" style="width: 100%">' + buttonText + '</button> </div>';
              //console.log(newButton);
              $( "#methodsLabel" ).append( $(newButton) );

            }

            ////////////////////////////////////////////////////


            function getSelectedText() {
                if (window.getSelection) {
                    txt = window.getSelection();
                } else if (window.document.getSelection) {
                    txt =window.document.getSelection();
                } else if (window.document.selection) {
                    txt = window.document.selection.createRange().text;
                }
                console.log(txt);
            }

            $("h1").css('color','white');

            $("h2").css('color','white');


            {#Change rows label color to white#}
            $(".linenos").css('color','white');


            $(document.body).on("change","#label_selector",function(){
                if(this.value == "")
                    $("#submit_btn").attr('disabled', "");
                else
                    $("#submit_btn").removeAttr('disabled');
            });

            $("#submit_btn").click(function () {
                let data_json = {     artifact_id: {{  artifact_id }},
                                                labeling_data: $('#label_selector').val(),
                                                duration: get_elapsed_seconds()};
                {#let data = JSON.stringify(data_json);#}
                $.post("/label", data_json, function (response, status) {
                    let response_json = $.parseJSON(response.toString())
                    ShowNotification(response_json['status'], "success");
                    ChangeSkipToNext();
                });
            });

        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    <script src="{{ url_for('static', filename='js/notification.js') }}"></script>
    <script src="{{ url_for('static', filename='js/header.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vendor/bootstrap-confirmation.min.js') }}"></script>
{% endblock %}
